(function(d,w){typeof exports=="object"&&typeof module!="undefined"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(d=typeof globalThis!="undefined"?globalThis:d||self,w(d.modernScreenshot={}))})(this,function(d){var xe;"use strict";var Vt=Object.defineProperty,jt=Object.defineProperties;var qt=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var _e=Math.pow,Fe=(d,w,p)=>w in d?Vt(d,w,{enumerable:!0,configurable:!0,writable:!0,value:p}):d[w]=p,x=(d,w)=>{for(var p in w||(w={}))Re.call(w,p)&&Fe(d,p,w[p]);if(G)for(var p of G(w))Ue.call(w,p)&&Fe(d,p,w[p]);return d},$=(d,w)=>jt(d,qt(w));var ke=(d,w)=>{var p={};for(var T in d)Re.call(d,T)&&w.indexOf(T)<0&&(p[T]=d[T]);if(d!=null&&G)for(var T of G(d))w.indexOf(T)<0&&Ue.call(d,T)&&(p[T]=d[T]);return p};var g=(d,w,p)=>new Promise((T,B)=>{var V=D=>{try{L(p.next(D))}catch(M){B(M)}},O=D=>{try{L(p.throw(D))}catch(M){B(M)}},L=D=>D.done?T(D.value):Promise.resolve(D.value).then(V,O);L((p=p.apply(d,w)).next())});function w(e,t){return e[13]=1,e[14]=t>>8,e[15]=t&255,e[16]=t>>8,e[17]=t&255,e}const p="p".charCodeAt(0),T="H".charCodeAt(0),B="Y".charCodeAt(0),V="s".charCodeAt(0);let O;function L(){const e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let r=0;r<8;r++)n=n&1?3988292384^n>>>1:n>>>1;e[t]=n}return e}function D(e){let t=-1;O||(O=L());for(let n=0;n<e.length;n++)t=O[(t^e[n])&255]^t>>>8;return t^-1}function M(e){const t=e.length-1;for(let n=t;n>=4;n--)if(e[n-4]===9&&e[n-3]===p&&e[n-2]===T&&e[n-1]===B&&e[n]===V)return n-3;return 0}function te(e,t,n=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=p,r[1]=T,r[2]=B,r[3]=V,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=t&255,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const o=D(r),s=new Uint8Array(4);if(s[0]=o>>>24,s[1]=o>>>16,s[2]=o>>>8,s[3]=o&255,n){const a=M(e);return e.set(r,a),e.set(s,a+13),e}else{const a=new Uint8Array(4);a[0]=0,a[1]=0,a[2]=0,a[3]=9;const i=new Uint8Array(54);return i.set(e,0),i.set(a,33),i.set(r,37),i.set(s,50),i}}const $e="AAlwSFlz",Be="AAAJcEhZ",Oe="AAAACXBI";function Le(e){let t=e.indexOf($e);return t===-1&&(t=e.indexOf(Be)),t===-1&&(t=e.indexOf(Oe)),t}const Y="[modern-screenshot]",P=typeof window!="undefined",Me=P&&"Worker"in window,ne=P&&"atob"in window,We=P&&"btoa"in window,K=P?(xe=window.navigator)==null?void 0:xe.userAgent:"",re=K.includes("Chrome"),J=K.includes("AppleWebKit")&&!re,oe=K.includes("Firefox"),Ve=e=>e&&"__CONTEXT__"in e,je=e=>e.constructor.name==="CSSFontFaceRule",qe=e=>e.constructor.name==="CSSImportRule",I=e=>e.nodeType===1,W=e=>typeof e.className=="object",ae=e=>W(e)&&e.tagName==="IMAGE",Q=e=>I(e)&&typeof e.style!="undefined"&&!W(e),He=e=>e.nodeType===8,ze=e=>e.nodeType===3,U=e=>e.tagName==="IMG",j=e=>e.tagName==="VIDEO",Xe=e=>e.tagName==="CANVAS",se=e=>e.tagName==="TEXTAREA",Ge=e=>e.tagName==="INPUT",Ye=e=>e.tagName==="STYLE",Ke=e=>e.tagName==="SCRIPT",Je=e=>e.tagName==="SELECT",Qe=e=>e.tagName==="SLOT",Ze=e=>e.tagName==="IFRAME",E=(...e)=>console.warn(Y,...e),et=e=>console.time(`${Y} ${e}`),tt=e=>console.timeEnd(`${Y} ${e}`),nt=e=>{var n;const t=(n=e==null?void 0:e.createElement)==null?void 0:n.call(e,"canvas");return t&&(t.height=t.width=1),t&&"toDataURL"in t&&Boolean(t.toDataURL("image/webp").includes("image/webp"))},Z=e=>e.startsWith("data:");function ie(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(P&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!P)return e;const n=q().implementation.createHTMLDocument(),r=n.createElement("base"),o=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(o),t&&(r.href=t),o.href=e,o.href}function q(e){var t;return(t=e&&I(e)?e==null?void 0:e.ownerDocument:e)!=null?t:window.document}function ce(e,t,n){const r=q(n).createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),r}function le(e){const t=new XMLSerializer().serializeToString(e).replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/ug,"");return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`}function rt(e,t="image/png",n=1){return g(this,null,function*(){try{return yield new Promise((r,o)=>{e.toBlob(s=>{s?r(s):o(new Error("Blob is null"))},t,n)})}catch(r){if(ne)return E("Failed canvas to blob",{type:t,quality:n},r),ot(e.toDataURL(t,n));throw r}})}function ot(e){var i,c;const[t,n]=e.split(","),r=(c=(i=t.match(/data:(.+);/))==null?void 0:i[1])!=null?c:void 0,o=window.atob(n),s=o.length,a=new Uint8Array(s);for(let l=0;l<s;l+=1)a[l]=o.charCodeAt(l);return new Blob([a],{type:r})}function ue(e,t){return new Promise((n,r)=>{const o=new FileReader;o.onload=()=>n(o.result),o.onerror=()=>r(o.error),o.onabort=()=>r(new Error(`Failed read blob to ${t}`)),t==="dataUrl"?o.readAsDataURL(e):t==="arrayBuffer"&&o.readAsArrayBuffer(e)})}const at=e=>ue(e,"dataUrl"),st=e=>ue(e,"arrayBuffer");function F(e,t){const n=q(t).createElement("img");return n.decoding="sync",n.loading="eager",n.src=e,n}function _(e,t){return new Promise(n=>{const{timeout:r,ownerDocument:o,onError:s}=t!=null?t:{},a=typeof e=="string"?F(e,q(o)):e;let i=null,c=null;function l(){n(a),i&&clearTimeout(i),c==null||c()}if(r&&(i=setTimeout(l,r)),j(a)){const u=a.currentSrc||a.src;if(!u)return a.poster?_(a.poster,t).then(n):l();if(a.readyState>=2)return l();const f=l,m=h=>{E("Failed video load",u,h),s==null||s(h),l()};c=()=>{a.removeEventListener("loadeddata",f),a.removeEventListener("error",m)},a.addEventListener("loadeddata",f,{once:!0}),a.addEventListener("error",m,{once:!0})}else{const u=ae(a)?a.href.baseVal:a.currentSrc||a.src;if(!u)return l();const f=()=>g(this,null,function*(){if(U(a)&&"decode"in a)try{yield a.decode()}catch(h){E("Failed to decode image, trying to render anyway",a.dataset.originalSrc||u,h)}l()}),m=h=>{E("Failed image load",a.dataset.originalSrc||u,h),l()};if(U(a)&&a.complete)return f();c=()=>{a.removeEventListener("load",f),a.removeEventListener("error",m)},a.addEventListener("load",f,{once:!0}),a.addEventListener("error",m,{once:!0})}})}function fe(e,t){return g(this,null,function*(){Q(e)&&(U(e)||j(e)?yield _(e,{timeout:t}):yield Promise.all(["img","video"].flatMap(n=>Array.from(e.querySelectorAll(n)).map(r=>_(r,{timeout:t})))))})}const de=function(){let t=0;const n=()=>`0000${(Math.random()*_e(36,4)<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)}();function it(e){return{time:t=>e&&et(t),timeEnd:t=>e&&tt(t),warn:(...t)=>e&&E(...t)}}function ct(e){return{cache:e?"no-cache":"force-cache"}}function N(e,t){return g(this,null,function*(){return Ve(e)?e:me(e,$(x({},t),{autoDestruct:!0}))})}function me(e,t){return g(this,null,function*(){var m,h,y,v;const{scale:n=1,workerUrl:r,workerNumber:o=1}=t||{},s=Boolean(t==null?void 0:t.debug),a=(m=e.ownerDocument)!=null?m:P?window.document:void 0,i=(y=(h=e.ownerDocument)==null?void 0:h.defaultView)!=null?y:P?window:void 0,c=new Map,l=$(x({width:0,height:0,quality:1,type:"image/png",scale:n,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:s,fetch:x({requestInit:ct((v=t==null?void 0:t.fetch)==null?void 0:v.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},t==null?void 0:t.fetch),font:{},drawImageInterval:100,workerUrl:null,workerNumber:o,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:it(s),node:e,ownerDocument:a,ownerWindow:i,dpi:n===1?null:96*n,svgStyleElement:ge(a),defaultComputedStyles:new Map,workers:[...new Array(Me&&r&&o?o:0)].map(()=>{const b=new Worker(r);return b.onmessage=S=>g(this,null,function*(){var R,De,X,Pe;const{url:A,result:C}=S.data;C?(De=(R=c.get(A))==null?void 0:R.resovle)==null||De.call(R,C):(Pe=(X=c.get(A))==null?void 0:X.reject)==null||Pe.call(X,new Error(`Error receiving message from worker: ${A}`))}),b.onmessageerror=S=>{var C,R;const{url:A}=S.data;(R=(C=c.get(A))==null?void 0:C.reject)==null||R.call(C,new Error(`Error receiving message from worker: ${A}`))},b}),fontFamilies:new Set,fontCssTexts:new Map,acceptOfImage:`${[nt(a)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:c,drawImageCount:0,tasks:[]});l.log.time("wait until load"),yield fe(e,l.timeout),l.log.timeEnd("wait until load");const{width:u,height:f}=lt(e,l);return l.width=u,l.height=f,l})}function ge(e){if(!e)return;const t=e.createElement("style"),n=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(n),t}function lt(e,t){let{width:n,height:r}=t;if(I(e)&&(!n||!r)){const o=e.getBoundingClientRect();n=n||o.width||Number(e.getAttribute("width"))||0,r=r||o.height||Number(e.getAttribute("height"))||0}return{width:n,height:r}}function ut(e,t){return g(this,null,function*(){const{log:n,timeout:r,drawImageCount:o,drawImageInterval:s}=t;n.time("image to canvas");const a=yield _(e,{timeout:r}),{canvas:i,context2d:c}=ft(e.ownerDocument,t),l=()=>{try{c==null||c.drawImage(a,0,0,i.width,i.height)}catch(u){E("Failed to drawImage",u)}};l();for(let u=0;u<o;u++)yield new Promise(f=>{setTimeout(()=>{l(),f()},u+s)});return t.drawImageCount=0,n.timeEnd("image to canvas"),i})}function ft(e,t){const{width:n,height:r,scale:o,backgroundColor:s,maximumCanvasSize:a}=t,i=e.createElement("canvas");i.width=Math.floor(n*o),i.height=Math.floor(r*o),i.style.width=`${n}px`,i.style.height=`${r}px`,a&&(i.width>a||i.height>a)&&(i.width>a&&i.height>a?i.width>i.height?(i.height*=a/i.width,i.width=a):(i.width*=a/i.height,i.height=a):i.width>a?(i.height*=a/i.width,i.width=a):(i.width*=a/i.height,i.height=a));const c=i.getContext("2d");return c&&s&&(c.fillStyle=s,c.fillRect(0,0,i.width,i.height)),{canvas:i,context2d:c}}function dt(e,t,n){he(e,t,":before",n),he(e,t,":after",n)}function he(e,t,n,r){const o=e.ownerDocument,s=r.getComputedStyle(e,n),a=s.getPropertyValue("content");if(!a||a==="none")return;const i=de();try{t.className=`${t.className} ${i}`}catch(f){return}const c=o.createElement("style"),l=`.${i}:${n}`,u=s.cssText?mt(s):gt(s);c.appendChild(o.createTextNode(`${l}{${u}}`)),t.appendChild(c)}function mt(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function gt(e){return Array.from(e).map(t=>{const n=e.getPropertyValue(t),r=e.getPropertyPriority(t);return`${t}: ${n}${r?" !important":""};`}).join(" ")}function ht(e,t){se(e)&&(t.innerHTML=e.value),(se(e)||Ge(e)||Je(e))&&(t.value=e.value)}function wt(e,t){var u;const{defaultComputedStyles:n,ownerDocument:r}=t;if(n.has(e))return n.get(e);let o=t.sandbox;if(o||r&&(o=r.createElement("iframe"),o.id=`__SANDBOX__-${de()}`,o.width="0",o.height="0",o.style.visibility="hidden",o.style.position="fixed",r.body.appendChild(o),(u=o.contentWindow)==null||u.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),t.sandbox=o),!o)return{};const s=o.contentWindow;if(!s)return{};const a=s.document,i=a.createElement(e);a.body.appendChild(i),i.textContent=" ";const c=s.getComputedStyle(i),l={};for(let f=c.length-1;f>=0;f--){const m=c.item(f);m==="width"||m==="height"?l[m]="auto":l[m]=c.getPropertyValue(m)}return a.body.removeChild(i),n.set(e,l),l}const pt=["transitionProperty","all","d","content"];function yt(e,t,n,r,o){const s=n.style,a=wt(e.tagName,o);s.transitionProperty="none";for(let i=t.length-1;i>=0;i--){const c=t.item(i);if(pt.includes(c))continue;const l=t.getPropertyValue(c),u=t.getPropertyPriority(c);if(r&&c.startsWith("margin")&&l){s.setProperty(c,"0",u);continue}if(c==="background-clip"&&l==="text"&&n.classList.add("______background-clip--text"),!(a[c]===l&&!e.getAttribute(c)&&!u)&&(s.setProperty(c,l,u),c.startsWith("border")&&c.endsWith("style"))){const f=c.replace("style","width");s.getPropertyValue(f)||s.setProperty(f,"0")}}re&&(s.fontKerning==="auto"&&(s.fontKerning="normal"),s.overflow==="hidden"&&s.textOverflow==="ellipsis"&&e.scrollWidth===e.clientWidth&&(s.textOverflow="clip"))}function bt(e,t){var n;try{if((n=e==null?void 0:e.contentDocument)!=null&&n.body)return ee(e.contentDocument.body,t)}catch(r){E("Failed to clone iframe",r)}return e.cloneNode(!1)}function we(e){if(e.ownerDocument)try{const o=e.toDataURL();if(o!=="data:,")return F(o,e.ownerDocument)}catch(o){}const t=e.cloneNode(!1),n=e.getContext("2d"),r=t.getContext("2d");try{return n&&r&&r.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(o){E("Failed to clone canvas",o)}return t}function St(e){return g(this,null,function*(){if(e.ownerDocument&&!e.currentSrc&&e.poster)return F(e.poster,e.ownerDocument);const t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);const n=t.ownerDocument;if(n){let r=!0;if(yield _(t,{onError:()=>r=!1}),!r)return e.poster?F(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,yield new Promise(s=>{t.addEventListener("seeked",s,{once:!0})});const o=n.createElement("canvas");o.width=e.offsetWidth,o.height=e.offsetHeight;try{const s=o.getContext("2d");s&&s.drawImage(t,0,0,o.width,o.height)}catch(s){return E("Failed to clone video",s),e.poster?F(e.poster,e.ownerDocument):t}return we(o)}return t})}function Ct(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}function Et(e,t){return Xe(e)?we(e):Ze(e)?bt(e,t):U(e)?Ct(e):j(e)?St(e):e.cloneNode(!1)}function pe(e,t,n){return g(this,null,function*(){I(t)&&(Ye(t)||Ke(t))||n.filter&&!n.filter(t)||e.appendChild(yield ee(t,n))})}function ye(e,t,n){return g(this,null,function*(){var o,s;const r=(s=I(e)?(o=e.shadowRoot)==null?void 0:o.firstChild:void 0)!=null?s:e.firstChild;for(let a=r;a;a=a.nextSibling)if(!He(a))if(I(a)&&Qe(a)&&typeof a.assignedNodes=="function"){const i=a.assignedNodes();for(let c=0;c<i.length;c++)yield pe(t,i[c],n)}else yield pe(t,a,n)})}function Tt(e,t){const{backgroundColor:n,width:r,height:o,style:s}=t;if(n&&(e.backgroundColor=n),r&&(e.width=`${r}px`),o&&(e.height=`${o}px`),s)for(const a in s)e[a]=s[a]}function ee(e,t,n=!1){return g(this,null,function*(){const{ownerDocument:r,ownerWindow:o,fontFamilies:s}=t;if(r&&ze(e))return r.createTextNode(e.data);if(r&&o&&I(e)&&(Q(e)||W(e))){const i=o.getComputedStyle(e);if(i.display==="none")return r.createComment(e.tagName.toLowerCase());const c=yield Et(e,t),l=c.style;return yt(e,i,c,n,t),n&&Tt(l,t),l.getPropertyValue("font-family").split(",").filter(Boolean).map(u=>u.toLowerCase()).forEach(u=>s.add(u)),dt(e,c,o),ht(e,c),j(e)||(yield ye(e,c,t)),c}const a=e.cloneNode(!1);return yield ye(e,a,t),a})}function be(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(t){}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}function At(e){const i=e,{url:t,timeout:n,responseType:r}=i,o=ke(i,["url","timeout","responseType"]),s=new AbortController,a=n?setTimeout(()=>s.abort(),n):void 0;return fetch(t,x({signal:s.signal},o)).then(c=>{if(!c.ok)throw new Error("Failed fetch, not 2xx response",{cause:c});switch(r){case"dataUrl":return c.blob().then(at);case"text":default:return c.text()}}).finally(()=>clearTimeout(a))}function H(e,t){const{url:n,requestType:r="text",responseType:o="text",imageDom:s}=t;let a=n;const{timeout:i,acceptOfImage:c,requests:l,fetch:{requestInit:u,bypassingCache:f,placeholderImage:m},workers:h}=e;let y;if(l.has(n))y=l.get(n);else{f&&(a+=(/\?/.test(a)?"&":"?")+new Date().getTime()),r==="image"&&J&&e.drawImageCount++;const v=x({url:a,timeout:i,responseType:o,headers:r==="image"?{accept:c}:void 0},u);y={type:r,resovle:void 0,reject:void 0,response:null},y.response=(h.length?new Promise((b,S)=>{h[l.size&h.length-1].postMessage(x({rawUrl:n},v)),y.resovle=b,y.reject=S}):At(v)).catch(b=>{if(l.delete(n),r==="image"&&m)return E("Failed to fetch image base64, trying to use placeholder image",a),typeof m=="string"?m:m(s);throw b}),l.set(n,y)}return y.response}function Se(e,t,n,r){return g(this,null,function*(){if(!Ce(e))return e;for(const[o,s]of vt(e,t))try{const a=yield H(n,{url:s,requestType:r?"image":"text",responseType:"dataUrl"});e=e.replace(It(o),`$1${a}$3`)}catch(a){E("Failed to fetch css data url",o,a)}return e})}function Ce(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const Ee=/url\((['"]?)([^'"]+?)\1\)/g;function vt(e,t){const n=[];return e.replace(Ee,(r,o,s)=>(n.push([s,ie(s,t)]),r)),n.filter(([r])=>!Z(r))}function It(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Nt(e,t){return g(this,null,function*(){const{ownerDocument:n,svgStyleElement:r,fontFamilies:o,fontCssTexts:s,tasks:a,font:i}=t;if(!(!n||!r||!o.size))if(i&&i.cssText){const c=Ae(i.cssText,t);r.appendChild(n.createTextNode(`${c}
`))}else{const c=Array.from(n.styleSheets).filter(u=>{try{return"cssRules"in u&&Boolean(u.cssRules.length)}catch(f){return E(`Error while reading CSS rules from ${u.href}`,f),!1}});yield Promise.all(c.flatMap(u=>Array.from(u.cssRules).map((f,m)=>g(this,null,function*(){if(qe(f)){let h=m+1;const y=f.href;let v="";try{v=yield H(t,{url:y,requestType:"text",responseType:"text"})}catch(S){E(`Error fetch remote css import from ${y}`,S)}const b=v.replace(Ee,(S,A,C)=>S.replace(C,ie(C,y)));for(const S of Dt(b))try{u.insertRule(S,S.startsWith("@import")?h+=1:u.cssRules.length)}catch(A){E("Error inserting rule from remote css import",{rule:S,error:A})}}})))),c.flatMap(u=>Array.from(u.cssRules)).filter(u=>je(u)&&Ce(u.style.getPropertyValue("src"))&&u.style.getPropertyValue("font-family").split(",").filter(Boolean).map(f=>f.toLowerCase()).some(f=>o.has(f))).forEach(u=>{const f=u,m=s.get(f.cssText);m?r.appendChild(n.createTextNode(`${m}
`)):a.push(Se(f.cssText,f.parentStyleSheet?f.parentStyleSheet.href:null,t).then(h=>{h=Ae(h,t),s.set(f.cssText,h),r.appendChild(n.createTextNode(`${h}
`))}))})}})}const xt=/(\/\*[\s\S]*?\*\/)/gi,Te=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function Dt(e){if(e==null)return[];const t=[];let n=e.replace(xt,"");for(;;){const s=Te.exec(n);if(!s)break;t.push(s[0])}n=n.replace(Te,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let s=r.exec(n);if(s)o.lastIndex=r.lastIndex;else if(s=o.exec(n),s)r.lastIndex=o.lastIndex;else break;t.push(s[0])}return t}const Pt=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Ft=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Ae(e,t){const{font:n}=t,r=n?n==null?void 0:n.preferredFormat:void 0;return r?e.replace(Ft,o=>{for(;;){const[s,,a]=Pt.exec(o)||[];if(!a)return"";if(a===r)return`src: ${s};`}}):e}function Rt(e,t){if(U(e)){const n=e.currentSrc||e.src;if(!Z(n))return[H(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.srcset="",e.dataset.originalSrc=n,e.src=r||"")})];(J||oe)&&n.includes("data:image/svg+xml")&&t.drawImageCount++}else if(W(e)&&!Z(e.href.baseVal)){const n=e.href.baseVal;return[H(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then(r=>{r&&(e.dataset.originalSrc=n,e.href.baseVal=r||"")})]}return[]}const Ut=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function _t(e,t){return Ut.map(n=>{const r=e.getPropertyValue(n);return r?((J||oe)&&r.includes("data:image/svg+xml")&&t.drawImageCount++,Se(r,null,t,!0).then(o=>{!o||r===o||e.setProperty(n,o,e.getPropertyPriority(n))})):null}).filter(Boolean)}function ve(e,t){const{tasks:n}=t;I(e)&&(U(e)||ae(e))&&n.push(...Rt(e,t)),Q(e)&&n.push(..._t(e.style,t)),e.childNodes.forEach(r=>{ve(r,t)})}function Ie(e,t){return g(this,null,function*(){const n=yield N(e,t);if(I(n.node)&&W(n.node))return n.node;const{log:r,tasks:o,svgStyleElement:s,font:a,progress:i,autoDestruct:c,onCloneNode:l,onEmbedNode:u,onCreateForeignObjectSvg:f}=n;r.time("clone node");const m=yield ee(n.node,n,!0);r.timeEnd("clone node"),l==null||l(m),a!==!1&&I(m)&&(r.time("embed web font"),yield Nt(m,n),r.timeEnd("embed web font")),r.time("embed node"),ve(m,n);const h=o.length;let y=0;const v=()=>g(this,null,function*(){for(;;){const S=o.pop();if(!S)break;try{yield S}catch(A){E("Failed to run task",A)}i==null||i(++y,h)}});i==null||i(y,h),yield Promise.all([...Array(4)].map(v)),r.timeEnd("embed node"),u==null||u(m);const b=kt(m,n);return s&&b.insertBefore(s,b.children[0]),c&&be(n),f==null||f(b),b})}function kt(e,t){const{width:n,height:r}=t,o=ce(n,r,e.ownerDocument),s=o.ownerDocument.createElementNS(o.namespaceURI,"foreignObject");return s.setAttributeNS(null,"x","0%"),s.setAttributeNS(null,"y","0%"),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.append(e),o.appendChild(s),o}function z(e,t){return g(this,null,function*(){const n=yield N(e,t),r=yield Ie(n),o=le(r);n.autoDestruct||(n.svgStyleElement=ge(n.ownerDocument));const s=F(o,r.ownerDocument);return yield ut(s,n)})}function $t(e,t){return g(this,null,function*(){const n=yield N(e,t),{log:r,type:o,quality:s,dpi:a}=n,i=yield z(n);r.time("canvas to blob");const c=yield rt(i,o,s);if(["image/png","image/jpeg"].includes(o)&&a){const l=yield st(c.slice(0,33));let u=new Uint8Array(l);return o==="image/png"?u=te(u,a):o==="image/jpeg"&&(u=w(u,a)),new Blob([u,c.slice(33)],{type:o})}return r.timeEnd("canvas to blob"),c})}function k(e,t){return g(this,null,function*(){const n=yield N(e,t),{log:r,quality:o,type:s,dpi:a}=n,i=yield z(n);r.time("canvas to data url");let c=i.toDataURL(s,o);if(["image/png","image/jpeg"].includes(s)&&a&&ne&&We){const[l,u]=c.split(",");let f=0,m=!1;if(s==="image/png"){const C=Le(u);C>=0?(f=Math.ceil((C+28)/3)*4,m=!0):f=33/3*4}else s==="image/jpeg"&&(f=18/3*4);const h=u.substring(0,f),y=u.substring(f),v=window.atob(h),b=new Uint8Array(v.length);for(let C=0;C<b.length;C++)b[C]=v.charCodeAt(C);const S=s==="image/png"?te(b,a,m):w(b,a),A=window.btoa(String.fromCharCode(...S));c=[l,",",A,y].join("")}return r.timeEnd("canvas to data url"),c})}function Ne(e,t){return g(this,null,function*(){const n=yield N(e,t),{width:r,height:o,ownerDocument:s}=n,a=yield k(n),i=ce(r,o,s),c=i.ownerDocument.createElementNS(i.namespaceURI,"image");return c.setAttributeNS(null,"href",a),c.setAttributeNS(null,"height","100%"),c.setAttributeNS(null,"width","100%"),i.appendChild(c),le(i)})}function Bt(e,t){return g(this,null,function*(){const n=yield N(e,t),{ownerDocument:r,width:o,height:s,scale:a,type:i}=n,c=i==="image/svg+xml"?yield Ne(n):yield k(n),l=F(c,r);return l.width=Math.floor(o*a),l.height=Math.floor(s*a),l.style.width=`${o}px`,l.style.height=`${s}px`,l})}function Ot(e,t){return g(this,null,function*(){return k(yield N(e,$(x({},t),{type:"image/jpeg"})))})}function Lt(e,t){return g(this,null,function*(){const n=yield N(e,t),r=yield z(n);return r.getContext("2d").getImageData(0,0,r.width,r.height).data})}function Mt(e,t){return g(this,null,function*(){return k(yield N(e,$(x({},t),{type:"image/png"})))})}function Wt(e,t){return g(this,null,function*(){return k(yield N(e,$(x({},t),{type:"image/webp"})))})}d.createContext=me,d.destroyContext=be,d.domToBlob=$t,d.domToCanvas=z,d.domToDataUrl=k,d.domToForeignObjectSvg=Ie,d.domToImage=Bt,d.domToJpeg=Ot,d.domToPixel=Lt,d.domToPng=Mt,d.domToSvg=Ne,d.domToWebp=Wt,d.loadMedia=_,d.waitUntilLoad=fe,Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})});
